
Функция ЕстьОтрицательныеОстатки(Ссылка, Дата, Склад) Экспорт
	
	///+ГомзМА 05.04.2023
	Результат = Ложь;
	Граница = Новый Граница(Дата, ВидГраницы.Включая);
	
	Если ТипЗнч(Ссылка) = Тип("ДокументСсылка.СписаниеТМЦСкладСнабжение") Тогда
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДвижениеТМЦСкладСнабжениеОстатки.ТМЦ КАК ТМЦ,
		|	ДвижениеТМЦСкладСнабжениеОстатки.МестоХранения КАК МестоХранения,
		|	ДвижениеТМЦСкладСнабжениеОстатки.ИнвентарныйНомер КАК ИнвентарныйНомер,
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток КАК КоличествоОстаток
		|ИЗ
		|	РегистрНакопления.ДвижениеТМЦСкладСнабжение.Остатки(
		|			&Дата,
		|			МестоХранения = &Склад
		|				И (ТМЦ, ИнвентарныйНомер) В
		|					(ВЫБРАТЬ
		|						СписаниеТМЦСкладСнабжениеСписокТМЦ.ТМЦ КАК ТМЦ,
		|						СписаниеТМЦСкладСнабжениеСписокТМЦ.ИнвентарныйНомер КАК ИнвентарныйНомер
		|					ИЗ
		|						Документ.СписаниеТМЦСкладСнабжение.СписокТМЦ КАК СписаниеТМЦСкладСнабжениеСписокТМЦ
		|					ГДЕ
		|						СписаниеТМЦСкладСнабжениеСписокТМЦ.Ссылка.Ссылка = &Ссылка)) КАК ДвижениеТМЦСкладСнабжениеОстатки
		|ГДЕ
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток < 0";
	
	ИначеЕсли ТипЗнч(Ссылка) = Тип("ДокументСсылка.ПеремещениеТМЦ") Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДвижениеТМЦСкладСнабжениеОстатки.ТМЦ КАК ТМЦ,
		|	ДвижениеТМЦСкладСнабжениеОстатки.МестоХранения КАК МестоХранения,
		|	ДвижениеТМЦСкладСнабжениеОстатки.ИнвентарныйНомер КАК ИнвентарныйНомер,
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток КАК КоличествоОстаток
		|ИЗ
		|	РегистрНакопления.ДвижениеТМЦСкладСнабжение.Остатки(
		|			&Дата,
		|			МестоХранения = &Склад
		|				И (ТМЦ, ИнвентарныйНомер) В
		|					(ВЫБРАТЬ
		|						ПеремещениеТМЦСписокТМЦ.ТМЦ КАК ТМЦ,
		|						ПеремещениеТМЦСписокТМЦ.ИнвентарныйНомер КАК ИнвентарныйНомер
		|					ИЗ
		|						Документ.ПеремещениеТМЦ.СписокТМЦ КАК ПеремещениеТМЦСписокТМЦ
		|					ГДЕ
		|						ПеремещениеТМЦСписокТМЦ.Ссылка.Ссылка = &Ссылка)) КАК ДвижениеТМЦСкладСнабжениеОстатки
		|ГДЕ
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток < 0";
		
	ИначеЕсли ТипЗнч(Ссылка) = Тип("ДокументСсылка.ЗаказНаряд") Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДвижениеТМЦСкладСнабжениеОстатки.ТМЦ КАК ТМЦ,
		|	ДвижениеТМЦСкладСнабжениеОстатки.МестоХранения КАК МестоХранения,
		|	ДвижениеТМЦСкладСнабжениеОстатки.ИнвентарныйНомер КАК ИнвентарныйНомер,
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток КАК КоличествоОстаток
		|ИЗ
		|	РегистрНакопления.ДвижениеТМЦСкладСнабжение.Остатки(
		|			&Дата,
		|			МестоХранения = &Склад
		|				И (ТМЦ, ИнвентарныйНомер) В
		|					(ВЫБРАТЬ
		|						ЗаказНарядТМЦ.ТМЦ КАК ТМЦ,
		|						ЗаказНарядТМЦ.ИнвентарныйНомер КАК ИнвентарныйНомер
		|					ИЗ
		|						Документ.ЗаказНаряд.ТМЦ КАК ЗаказНарядТМЦ
		|					ГДЕ
		|						ЗаказНарядТМЦ.Ссылка.Ссылка = &Ссылка)) КАК ДвижениеТМЦСкладСнабжениеОстатки
		|ГДЕ
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток < 0";
		
	ИначеЕсли ТипЗнч(Ссылка) = Тип("ДокументСсылка.ПродажаЗапчастей") Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДвижениеТМЦСкладСнабжениеОстатки.ТМЦ КАК ТМЦ,
		|	ДвижениеТМЦСкладСнабжениеОстатки.МестоХранения КАК МестоХранения,
		|	ДвижениеТМЦСкладСнабжениеОстатки.ИнвентарныйНомер КАК ИнвентарныйНомер,
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток КАК КоличествоОстаток
		|ИЗ
		|	РегистрНакопления.ДвижениеТМЦСкладСнабжение.Остатки(
		|			&Дата,
		|			МестоХранения = &Склад
		|				И (ТМЦ, ИнвентарныйНомер) В
		|					(ВЫБРАТЬ
		|						ПродажаЗапчастей.ТМЦ КАК ТМЦ,
		|						ПродажаЗапчастей.ИнвентарныйНомер КАК ИнвентарныйНомер
		|					ИЗ
		|						Документ.ПродажаЗапчастей.ТМЦ КАК ПродажаЗапчастей
		|					ГДЕ
		|						ПродажаЗапчастей.Ссылка.Ссылка = &Ссылка)) КАК ДвижениеТМЦСкладСнабжениеОстатки
		|ГДЕ
		|	ДвижениеТМЦСкладСнабжениеОстатки.КоличествоОстаток < 0";
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Дата", 		Граница);
	Запрос.УстановитьПараметр("Ссылка", 	Ссылка);
	Запрос.УстановитьПараметр("Склад", 		Склад);

	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если НЕ РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			//Если ТипЗнч(Склад) = Тип("СправочникСсылка.МестаХраненияТМЦ") Тогда
			//	СтрокаВывода = СтрШаблон("Не хватает товара %1 на складе: ""%2"", в количестве %3", 	Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
			//	Сообщить(СтрокаВывода);
			//ИначеЕсли ТипЗнч(Склад) = Тип("СправочникСсылка.Пользователи") Тогда
			//	СтрокаВывода = СтрШаблон("Не хватает товара %1 у сотрудника: ""%2"", в количестве %3", 	Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
			//	Сообщить(СтрокаВывода);
			//ИначеЕсли ТипЗнч(Склад) = Тип("СправочникСсылка.Подразделения") Тогда
			//	СтрокаВывода = СтрШаблон("Не хватает товара %1 в отделе: ""%2"", в количестве %3", 		Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
			//	Сообщить(СтрокаВывода);
			//Иначе
			//	СтрокаВывода = СтрШаблон("Отсутствует товар %1, в количестве %2", 						Выборка.ТМЦ, -Выборка.КоличествоОстаток);
			//	Сообщить(СтрокаВывода);
			//КонецЕсли;
			
			Если ТипЗнч(Склад.ВидСписания) = Перечисления.ВидыСписания.Сотруднику Тогда
				СтрокаВывода = СтрШаблон("Не хватает товара %1 у сотрудника: ""%2"", в количестве %3", 	Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
				Сообщить(СтрокаВывода);
			ИначеЕсли ТипЗнч(Склад.ВидСписания) = Перечисления.ВидыСписания.ВОтдел Тогда
				СтрокаВывода = СтрШаблон("Не хватает товара %1 в отделе: ""%2"", в количестве %3", 		Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
				Сообщить(СтрокаВывода);
			Иначе
				СтрокаВывода = СтрШаблон("Не хватает товара %1 на складе: ""%2"", в количестве %3", 	Выборка.ТМЦ, Выборка.МестоХранения, -Выборка.КоличествоОстаток);
				Сообщить(СтрокаВывода);
			КонецЕсли;
		КонецЦикла;
		Результат = Истина;
	КонецЕсли;	
	
	Возврат Результат;
	///-ГомзМА 05.04.2023 
	
КонецФункции //ЕстьОтрицательныеОстатки(Ссылка, Дата, Склад)